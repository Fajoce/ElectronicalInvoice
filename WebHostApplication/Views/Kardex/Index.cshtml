@model IEnumerable<WebHostApplication.Models.Kardex>

@{
    ViewData["Title"] = "Kardex";
}

<div class="content-inner py-4">

    <!-- 🔹 Título -->
    <div class="text-center mb-4">
        <h2 class="fw-bold">📦 Kardex de Movimientos</h2>
        <p class="text-muted">Consulta y filtra movimientos por producto</p>
    </div>

    <!-- 🔹 Filtros -->
    <div class="card shadow-sm mb-4 border-0 rounded-3">
        <div class="card-body">
            <form method="get" class="row g-3 justify-content-center align-items-end">

                <!-- Select de productos -->
                <div class="col-12 col-md-6">
                    <label for="productoId" class="form-label fw-semibold">Producto</label>
                    <select name="productoId" id="productoId" asp-items="ViewBag.Productos" class="form-select">
                        <option value="">-- Selecciona un producto --</option>
                    </select>
                </div>

                <!-- Botones -->
                <div class="col-12 col-md-4 text-md-start text-center">
                    <button type="submit" class="btn btn-primary w-100 mb-2 mb-md-0">
                        <i class="bi bi-funnel"></i> Filtrar
                    </button>
                    <a asp-action="Index" class="btn btn-outline-secondary w-100">
                        <i class="bi bi-x-circle"></i> Limpiar
                    </a>
                </div>
            </form>
        </div>
    </div>

    <!-- 🔹 Tabla (solo visible en pantallas grandes) -->
    <div class="card shadow-sm border-0 rounded-3 d-none d-md-block">
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-striped table-hover align-middle mb-0">
                    <thead class="table-dark text-center">
                        <tr>
                            <th>Fecha</th>
                            <th>Tipo</th>
                            <th>Producto</th>
                            <th>Descripción</th>
                            <th>Cantidad</th>
                            <th>Precio Venta</th>
                            <th>Precio Costo</th>
                            <th>Utilidad</th>
                            <th>Exist. Antes</th>
                            <th>Exist. Después</th>
                            <th>Referencia</th>
                            <th>Usuario</th>
                            <th>Observación</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model)
                        {
                            <tr>
                                <td>@item.Fecha.ToString("dd/MM/yyyy HH:mm")</td>
                                <td>@item.TipoMovimiento</td>
                                <td>@item.ProductoId</td>
                                <td>@item.Descripcion</td>
                                <td>@item.Cantidad</td>
                                <td>@item.PrecioVenta</td>
                                <td>@item.PrecioCosto</td>
                                <td>@item.Utilidad</td>
                                <td>@item.ExistenciaAntes</td>
                                <td>@item.ExistenciaDespues</td>
                                <td>@item.ReferenciaDocumento</td>
                                <td>@item.Usuario</td>
                                <td>@item.Observacion</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- 🔹 Cards individuales (solo móviles) -->
    <div class="d-md-none">
        @foreach (var item in Model)
        {
            <div class="card mb-3 shadow-sm border-0">
                <div class="card-body">
                    <h6 class="fw-bold text-primary mb-2">@item.ProductoId</h6>
                    <p class="mb-1"><strong>Tipo:</strong> @item.TipoMovimiento</p>
                    <p class="mb-1"><strong>Cantidad:</strong> @item.Cantidad</p>
                    <p class="mb-1"><strong>Precio Venta:</strong> $@item.PrecioVenta</p>
                    <p class="mb-1"><strong>Utilidad:</strong> $@item.Utilidad</p>
                    <p class="mb-1"><strong>Existencia:</strong> @item.ExistenciaAntes → @item.ExistenciaDespues</p>
                    <p class="mb-1"><strong>Usuario:</strong> @item.Usuario</p>
                    <p class="text-muted small mb-0"><strong>Fecha:</strong> @item.Fecha.ToString("dd/MM/yyyy HH:mm")</p>
                </div>
            </div>
        }

        @if (!Model.Any())
        {
            <div class="alert alert-warning text-center mt-4">
                No se encontraron movimientos para el producto seleccionado.
            </div>
        }
    </div>
    <!-- 🔹 Barra de paginación -->
    <div class="d-flex justify-content-center mt-4 mb-5">
        @if (ViewBag.TotalPages > 1)
        {
            <nav aria-label="Paginación de Kardex">
                <ul class="pagination pagination-lg justify-content-center mb-0">
                    <li class="page-item @(ViewBag.CurrentPage == 1 ? "disabled" : "")">
                        <a class="page-link"
                           asp-action="Index"
                           asp-route-productoId="@ViewBag.ProductoSeleccionado"
                           asp-route-page="@(ViewBag.CurrentPage - 1)">
                            &laquo;
                        </a>
                    </li>

                    @for (int i = 1; i <= ViewBag.TotalPages; i++)
                    {
                        <li class="page-item @(i == ViewBag.CurrentPage ? "active" : "")">
                            <a class="page-link"
                               asp-action="Index"
                               asp-route-productoId="@ViewBag.ProductoSeleccionado"
                               asp-route-page="@i">
                                @i
                            </a>
                        </li>
                    }

                    <li class="page-item @(ViewBag.CurrentPage == ViewBag.TotalPages ? "disabled" : "")">
                        <a class="page-link"
                           asp-action="Index"
                           asp-route-productoId="@ViewBag.ProductoSeleccionado"
                           asp-route-page="@(ViewBag.CurrentPage + 1)">
                            &raquo;
                        </a>
                    </li>
                </ul>
            </nav>
        }
    </div>
</div>


<!-- Bootstrap Icons -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

<!-- Meta responsive para móviles -->
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
    .content-inner {
        width: 100%;
    }

    .pagination-nav {
        display: flex;
        justify-content: center;
        margin-top: 2rem;
    }

    .pagination {
        flex-wrap: wrap;
        justify-content: center;
    }

    /* Asegura que la tabla no rompa el layout */
    .table-responsive {
        overflow-x: auto;
    }

    media (max-width: 768px) {
        .content-inner

    {
        padding: 1rem;
    }

    }
</style>